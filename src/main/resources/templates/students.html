<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student List</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@500;600;700&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/app.css">
</head>
<body>
<div class="page">
  <header class="topbar">
    <a class="brand" href="/">
      <span class="brand-dot"></span>
      Student System
    </a>

    <nav class="nav-links">
      <a class="nav-link is-active" href="/students">Students</a>
      <a class="nav-link" href="/courses">Courses</a>
    </nav>

    <div class="topbar__meta">
      <div class="user-chip">
        <span>Logged in as</span>
        <strong sec:authentication="name">User</strong>
        <span sec:authorize="hasRole('TEACHER')" class="pill pill--teacher">Teacher</span>
        <span sec:authorize="hasRole('STUDENT')" class="pill pill--student">Student</span>
      </div>
      <form th:action="@{/logout}" method="post">
        <button class="button button--ghost button--small" type="submit">Logout</button>
      </form>
    </div>
  </header>

  <main class="shell">
    <div class="page-head">
      <div>
        <p class="eyebrow">Dashboard</p>
        <h1 class="title">Student roster</h1>
        <p class="subtitle">Manage profiles and departments with ease.</p>
      </div>
      <div sec:authorize="hasRole('TEACHER')" class="page-head__actions">
        <a href="/students/new" class="button button--primary">Add student</a>
      </div>
    </div>

    <div class="table-card">
      <div class="table-scroll">
        <table class="table">
          <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Department</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="student : ${students}">
            <td th:text="${student.id}">1</td>
            <td th:text="${student.name}">Name</td>
            <td th:text="${student.email}">Email</td>
            <td th:text="${student.department?.name}">Dept</td>
            <td>
              <div class="table-actions">
                <a sec:authorize="hasRole('TEACHER')"
                   th:href="@{/students/edit/{id}(id=${student.id})}"
                   class="button button--small">
                  Edit
                </a>

                <a sec:authorize="hasRole('STUDENT')"
                   th:if="${student.user != null and #authentication.name == student.user.username}"
                   th:href="@{/students/edit/{id}(id=${student.id})}"
                   class="button button--small">
                  Edit
                </a>

                <a sec:authorize="hasRole('TEACHER')"
                   th:href="@{/students/delete/{id}(id=${student.id})}"
                   class="button button--danger-outline button--small"
                   onclick="return confirm('Are you sure?')">
                  Delete
                </a>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>
</body>
</html>
